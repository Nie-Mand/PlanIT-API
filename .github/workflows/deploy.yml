name: Deployment
on: [push]
env:
  JWT_SECRET: ${{ secrets.JWT_SECRET }}
  SALT: ${{ secrets.SALT }}
  COCKROACHDB_HOST: ${{ secrets.COCKROACHDB_HOST }}
  COCKROACHDB_PORT: ${{ secrets.COCKROACHDB_PORT }}
  COCKROACHDB_USERNAME: ${{ secrets.COCKROACHDB_USERNAME }}
  COCKROACHDB_PASSWORD: ${{ secrets.COCKROACHDB_PASSWORD }}
  COCKROACHDB_DATABASE: ${{ secrets.COCKROACHDB_DATABASE }}
  COURIER_API_URI: ${{ secrets.COURIER_API_URI }}
  COURIER_TOKEN: ${{ secrets.COURIER_TOKEN }}
  COURIER_MAIL_EVENT: ${{ secrets.COURIER_MAIL_EVENT }}
  COURIER_SMS_EVENT: ${{ secrets.COURIER_SMS_EVENT }}
  COURIER_EMAIL_ME: ${{ secrets.COURIER_EMAIL_ME }}
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      # clone the repository
      - uses: actions/checkout@v2
        with:
          ref: prod

      # installe node
      - uses: actions/setup-node@v2
        with:
          node-version: "16"
          cache: "npm"
          cache-dependency-path: "**/package-lock.json"
      - name: Server >  Install dependencies
        run: |
          cd server
          npm i
      - name: Server >  Build Server
        run: |
          cd server
          npm run build
      - name: Server >  Test if it works
        run: |
          cd server/build
          npm run start

# - name: installing Dependencies
# run: npm i
# - name: building
# run: npm run build
# - name: deploying
# run: echo etc
# - name: Done
# run: echo Done!
